<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario | Inversiones Yegni-Maik</title>

<style>
:root{
  --azul:#0b5ed7;
  --azul-oscuro:#084298;
  --naranja:#f59e0b;
  --rojo:#dc2626;
  --gris:#f4f6f8;
}

*{box-sizing:border-box;font-family:system-ui;margin:0;padding:0}

body{background:#fff;color:#333;padding:10px}

header{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:10px
}
header img{height:60px}
header h1{font-size:18px;color:var(--azul-oscuro)}
header span{font-size:11px;color:#666}

.card{
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.08)
}

h2{font-size:14px;color:var(--azul-oscuro);margin-bottom:8px}

.tabs{
  display:flex;
  border-radius:10px;
  overflow:hidden;
  border:1px solid var(--azul);
  margin-bottom:10px
}
.tab{
  flex:1;
  padding:8px;
  font-size:13px;
  background:#fff;
  border:none;
  cursor:pointer
}
.tab.active{background:var(--azul);color:#fff;font-weight:600}
.tab.egreso.active{background:var(--naranja)}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px
}
.grid.full{grid-template-columns:1fr}

label{font-size:11px;color:#555}
input,select{
  width:100%;
  padding:7px;
  font-size:12px;
  border-radius:6px;
  border:1px solid #ccc
}

button{
  width:100%;
  padding:9px;
  border:none;
  border-radius:8px;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  margin-top:8px
}
.btn-ingreso{background:var(--azul)}
.btn-egreso{background:var(--naranja)}
.btn-danger{background:var(--rojo)}

.table-wrap{
  max-height:260px;
  overflow:auto;
  border:1px solid #eee;
  border-radius:10px
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:11px
}
th,td{padding:6px;border-bottom:1px solid #eee}
th{background:var(--gris);position:sticky;top:0}

.alerta{color:var(--rojo);font-weight:700}
.pill{
  padding:2px 6px;
  border-radius:999px;
  font-size:10px;
  border:1px solid
}
.ok{color:var(--azul);border-color:var(--azul)}
.critico{color:var(--rojo);border-color:var(--rojo)}

@media(max-width:600px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <div>
    <h1>Inversiones Yegni-Maik</h1>
    <span>Sistema interno de inventario de almacén</span>
  </div>
</header>

<section class="card">
<h2>Movimiento de inventario</h2>

<div class="tabs">
  <button class="tab active" id="tabIngreso">Ingreso</button>
  <button class="tab egreso" id="tabEgreso">Egreso</button>
</div>

<form id="form">
<input type="hidden" id="tipo" value="INGRESO">

<div class="grid">
<div>
<label>Producto</label>
<input id="producto" required>
</div>

<div>
<label>Categoría</label>
<select id="categoria" required>
<option value="">Seleccione</option>
<option>aseo e higiene</option>
<option>jugueteria</option>
<option>bebidas alcoholicas</option>
<option>accesorios</option>
<option>papeleria</option>
<option>alimentos</option>
<option>embutidos</option>
<option>golosinas y dulces</option>
<option>bazar</option>
<option>utensilios básicos</option>
<option>productos para bebe</option>
<option>ferretería</option>
</select>
</div>

<div>
<label>Cantidad</label>
<input type="number" id="cantidad" min="1" required>
</div>

<div>
<label>Precio USD</label>
<input type="number" step="0.01" id="precio">
</div>

<div>
<label>Responsable</label>
<input id="responsable" required>
</div>

<div>
<label>Características</label>
<input id="caracteristicas">
</div>
</div>

<button class="btn-ingreso" id="btnGuardar">Registrar</button>
</form>
</section>

<section class="card">
<h2>Inventario</h2>

<input id="buscar" placeholder="Buscar producto">

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Producto</th>
<th>Stock</th>
<th>Estado</th>
<th>Ingresos</th>
<th>Egresos</th>
<th>Responsables</th>
</tr>
</thead>
<tbody id="tablaInventario"></tbody>
</table>
</div>
</section>

<section class="card">
<h2>Historial diario</h2>

<button class="btn-ingreso" id="btnExcel">Exportar Excel</button>
<button class="btn-danger" id="btnBorrar">Borrar historial</button>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Fecha</th>
<th>Tipo</th>
<th>Producto</th>
<th>Cant.</th>
<th>USD</th>
<th>Responsable</th>
</tr>
</thead>
<tbody id="tablaHistorial"></tbody>
</table>
</div>
</section>

<script>
const storeKey="inventario_yegni";
let movimientos=JSON.parse(localStorage.getItem(storeKey))||[];

const form=document.getElementById("form");
const tipo=document.getElementById("tipo");
const precio=document.getElementById("precio");

document.getElementById("tabIngreso").onclick=()=>{
  tipo.value="INGRESO";
  precio.disabled=false;
};

document.getElementById("tabEgreso").onclick=()=>{
  tipo.value="EGRESO";
  precio.disabled=true;
};

form.onsubmit=e=>{
e.preventDefault();

let prod=producto.value.toUpperCase();
let cant=+cantidad.value;
let prec=+precio.value||0;

if(tipo.value==="EGRESO"){
  let ult=movimientos.reverse().find(m=>m.producto===prod && m.tipo==="INGRESO");
  if(!ult)return alert("Producto sin ingreso");
  prec=ult.precio;
}

movimientos.push({
  fecha:new Date().toLocaleString(),
  tipo:tipo.value,
  producto:prod,
  cantidad:cant,
  precio:prec,
  total:prec*cant,
  responsable:responsable.value
});

localStorage.setItem(storeKey,JSON.stringify(movimientos));
form.reset();
render();
};

function render(){
tablaInventario.innerHTML="";
tablaHistorial.innerHTML="";

let inv={};

movimientos.forEach(m=>{
  inv[m.producto]=inv[m.producto]||{stock:0,ing:0,egr:0,resp:new Set()};
  m.tipo==="INGRESO"?inv[m.producto].stock+=m.cantidad:inv[m.producto].stock-=m.cantidad;
  m.tipo==="INGRESO"?inv[m.producto].ing++:inv[m.producto].egr++;
  inv[m.producto].resp.add(m.responsable);

  let tr=document.createElement("tr");
  tr.innerHTML=`<td>${m.fecha}</td><td>${m.tipo}</td><td>${m.producto}</td><td>${m.cantidad}</td><td>${m.total.toFixed(2)}</td><td>${m.responsable}</td>`;
  tablaHistorial.appendChild(tr);
});

Object.keys(inv).forEach(p=>{
let i=inv[p];
let crit=i.stock<10;
let tr=document.createElement("tr");
tr.innerHTML=`<td>${p}</td><td class="${crit?"alerta":""}">${i.stock}</td>
<td><span class="pill ${crit?"critico":"ok"}">${crit?"ALERTA":"OK"}</span></td>
<td>${i.ing}</td><td>${i.egr}</td><td>${[...i.resp].join(", ")}</td>`;
tablaInventario.appendChild(tr);
});
}

document.getElementById("btnBorrar").onclick=()=>{
if(confirm("¿Borrar historial?")){
movimientos=[];
localStorage.removeItem(storeKey);
render();
}
};

document.getElementById("btnExcel").onclick=()=>{
let csv="Fecha,Tipo,Producto,Cantidad,USD,Responsable\n";
movimientos.forEach(m=>{
csv+=`${m.fecha},${m.tipo},${m.producto},${m.cantidad},${m.total},${m.responsable}\n`;
});
let a=document.createElement("a");
a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
a.download="historial_yegni_maik.csv";
a.click();
};

document.getElementById("buscar").oninput=e=>{
[...tablaInventario.rows].forEach(r=>{
r.style.display=r.innerText.includes(e.target.value.toUpperCase())?"":"none";
});
};

render();
</script>

</body>
</html>
