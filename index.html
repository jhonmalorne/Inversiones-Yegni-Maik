<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inversiones Yegni-Maik - Inventario Almac√©n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c5f2d;
            --secondary: #4a7c59;
            --accent: #8bc34a;
            --danger: #d32f2f;
            --warning: #f57c00;
            --dark: #1a1a1a;
            --light: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .login-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-box {
            background: var(--white);
            padding: 3rem;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            max-width: 420px;
            width: 90%;
        }

        .logo {
            height: 80px;
            margin-bottom: 1.5rem;
            border-radius: 16px;
        }

        .login-box h2 {
            color: var(--primary);
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 700;
        }

        .status {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            z-index: 999;
            min-width: 160px;
            text-align: center;
            font-size: 0.9rem;
        }

        .status.online { background: #4caf50; color: white; }
        .status.offline { background: #f44336; color: white; }
        .status.syncing { background: #ff9800; color: white; animation: pulse 1.5s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 3px solid var(--accent);
        }

        .tab-btn {
            flex: 1;
            padding: 1.25rem;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }

        .tab-btn:hover { background: rgba(139,195,74,0.1); }
        .tab-btn.active {
            background: var(--white);
            color: var(--primary);
            border-bottom-color: var(--accent);
        }

        .tab-content {
            display: none;
            padding: 2.5rem;
            min-height: 60vh;
        }

        .tab-content.active { display: block; }

        .form-group {
            margin-bottom: 1.75rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(139,195,74,0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-size: 1.1rem;
            padding: 1.25rem 3rem;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-secondary { background: #6c757d; color: white; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid #f1f3f4;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .inventory-table th {
            background: var(--primary);
            color: white;
            padding: 1.25rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .inventory-table td {
            padding: 1.25rem;
            border-bottom: 1px solid #f1f3f4;
        }

        .inventory-table tr:hover {
            background: #f8f9fa;
        }

        .low-stock {
            background: #fff3cd !important;
            border-left: 5px solid var(--warning) !important;
        }

        .search-filter {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--light);
            border-radius: 16px;
            border: 2px solid #e9ecef;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--white);
            margin: 5% auto;
            padding: 2.5rem;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        @media (max-width: 768px) {
            body { padding: 0.5rem; }
            .form-row { grid-template-columns: 1fr; }
            .container { border-radius: 0; margin: 0; }
            .inventory-table { font-size: 0.9rem; }
            .inventory-table th, .inventory-table td { padding: 0.75rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <img src="logo.png" alt="Inversiones Yegni-Maik" class="logo" onerror="this.style.display='none'">
            <h2>üîê Sistema de Inventario</h2>
            <div class="form-group">
                <input type="text" id="username" placeholder="üë§ Usuario" value="admin">
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="üîí Contrase√±a">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%;">
                üöÄ Acceder al Almac√©n
            </button>
            <p style="margin-top: 1.5rem; color: #666; font-size: 0.9rem;">
                admin / 1234
            </p>
        </div>
    </div>

    <!-- STATUS -->
    <div class="status online" id="status">üü¢ Sistema Activo</div>

    <!-- APP PRINCIPAL -->
    <div class="container" id="app" style="display: none;">
        <div class="header">
            <h1>Inversiones Yegni-Maik</h1>
            <p>Sistema de Inventario Almac√©n ‚Ä¢ Tiempo Real</p>
            <button class="btn btn-secondary" onclick="logout()" style="position: absolute; right: 2rem; top: 2rem; padding: 0.75rem 1.5rem;">
                üö™ Salir
            </button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="showTab('ingreso')">‚ûï Ingreso</button>
            <button class="tab-btn" onclick="showTab('egreso')">‚ûñ Egreso</button>
            <button class="tab-btn" onclick="showTab('historial')">üìã Historial</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalProducts">0</div>
                    <div>Productos Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalStock">0</div>
                    <div>Unidades en Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lowStock">0</div>
                    <div><span style="color: var(--warning);">‚ö†Ô∏è</span> Stock Bajo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayMoves">0</div>
                    <div>Movimientos Hoy</div>
                </div>
            </div>

            <div class="search-filter">
                <input type="text" id="searchInput" placeholder="üîç Buscar producto por nombre..." oninput="filterProducts()">
            </div>

            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Categor√≠a</th>
                        <th>Stock</th>
                        <th>Precio ($)</th>
                        <th>Ingresos</th>
                        <th>Egresos</th>
                        <th>Caracter√≠sticas</th>
                    </tr>
                </thead>
                <tbody id="inventoryBody"></tbody>
            </table>
        </div>

        <!-- INGRESO -->
        <div id="ingreso" class="tab-content">
            <div class="form-group">
                <label>Nombre del Producto *</label>
                <input type="text" id="productoIngreso" placeholder="Ej: Jab√≥n Dove">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Categor√≠a *</label>
                    <select id="categoriaIngreso">
                        <option value="">Seleccionar...</option>
                        <option value="Aseo e Higiene">üßº Aseo e Higiene</option>
                        <option value="Jugueter√≠a">üß∏ Jugueter√≠a</option>
                        <option value="Bebidas Alcoh√≥licas">üç∫ Bebidas Alcoh√≥licas</option>
                        <option value="Accesorios">üì± Accesorios</option>
                        <option value="Papeler√≠a">üìù Papeler√≠a</option>
                        <option value="Alimentos">ü•õ Alimentos</option>
                        <option value="Embutidos">ü•ì Embutidos</option>
                        <option value="Golosinas y Dulces">üç≠ Golosinas y Dulces</option>
                        <option value="Bazar">üè™ Bazar</option>
                        <option value="Utensilios B√°sicos">üçΩÔ∏è Utensilios B√°sicos</option>
                        <option value="Productos para Beb√©">üë∂ Productos para Beb√©</option>
                        <option value="Ferreter√≠a">üîß Ferreter√≠a</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cantidad *</label>
                    <input type="number" id="cantidadIngreso" min="1" placeholder="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Precio Unitario ($)*</label>
                    <input type="number" id="precioIngreso" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Responsable *</label>
                    <input type="text" id="responsableIngreso" placeholder="Nombre Completo">
                </div>
            </div>
            <div class="form-group">
                <label>Caracter√≠sticas</label>
                <textarea id="caracteristicasIngreso" rows="3" placeholder="500ml, aroma lavanda, caja 24un..."></textarea>
            </div>
            <button class="btn btn-primary" onclick="agregarIngreso()" style="width: 100%;">
                ‚ûï Registrar Ingreso al Almac√©n
            </button>
        </div>

        <!-- EGRESO -->
        <div id="egreso" class="tab-content">
            <div class="form-group">
                <label>Seleccionar Producto *</label>
                <select id="productoEgreso" onchange="cargarDatosProducto()">
                    <option value="">Cargando productos...</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <input type="text" id="categoriaEgreso" readonly>
                </div>
                <div class="form-group">
                    <label>Stock Actual</label>
                    <input type="number" id="stockActual" readonly style="font-weight: 700; color: var(--primary);">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Cantidad a Retirar *</label>
                    <input type="number" id="cantidadEgreso" min="1" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Responsable *</label>
                    <input type="text" id="responsableEgreso" placeholder="Nombre Completo">
                </div>
            </div>
            <div class="form-group">
                <label>Precio Total Autom√°tico ($)</label>
                <input type="number" id="precioEgreso" step="0.01" readonly style="font-weight: 700; color: var(--accent);">
            </div>
            <button class="btn btn-primary" onclick="registrarEgreso()" style="width: 100%;">
                ‚ûñ Registrar Salida del Almac√©n
            </button>
        </div>

        <!-- HISTORIAL -->
        <div id="historial" class="tab-content">
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="exportarExcel()">üìä Exportar Excel</button>
                <button class="btn btn-danger" onclick="mostrarBorrarHistorial()">üóëÔ∏è Borrar Historial</button>
                <button class="btn btn-secondary" onclick="filtrarHoy()">üìÖ Solo Hoy</button>
                <button class="btn btn-primary" onclick="sincronizarManual()">üîÑ Sincronizar</button>
            </div>
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Fecha/Hora</th>
                        <th>Tipo</th>
                        <th>Producto</th>
                        <th>Categor√≠a</th>
                        <th>Cant.</th>
                        <th>Precio ($)</th>
                        <th>Responsable</th>
                    </tr>
                </thead>
                <tbody id="historialBody"></tbody>
            </table>
        </div>
    </div>

    <!-- MODAL BORRAR -->
    <div id="modalBorrar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal()" style="float: right; font-size: 2rem; cursor: pointer;">√ó</span>
            <h2 style="color: var(--danger);">‚ö†Ô∏è Confirmar Eliminaci√≥n</h2>
            <p style="margin-bottom: 2rem;">¬øEst√°s seguro de borrar <strong>TODO</strong> el historial? Esta acci√≥n no se puede deshacer.</p>
            <div style="text-align: right; gap: 1rem; display: flex; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                <button class="btn btn-danger" onclick="confirmarBorrarHistorial()">S√≠, Borrar Todo</button>
            </div>
        </div>
    </div>

    <script>
        // SISTEMA LOCALSTORAGE PERMANENTE
        let inventario = JSON.parse(localStorage.getItem('inventarioYegni')) || [];
        let historial = JSON.parse(localStorage.getItem('historialYegni')) || [];
        let onlineStatus = navigator.onLine;

        // CATEGOR√çAS PREDEFINIDAS
        const categorias = [
            'Aseo e Higiene', 'Jugueter√≠a', 'Bebidas Alcoh√≥licas', 'Accesorios',
            'Papeler√≠a', 'Alimentos', 'Embutidos', 'Golosinas y Dulces',
            'Bazar', 'Utensilios B√°sicos', 'Productos para Beb√©', 'Ferreter√≠a'
        ];

        // LOGIN SIMPLE
        function login() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            
            if (user === 'admin' && pass === '1234') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                inicializarSistema();
                actualizarStatus(true);
            } else {
                alert('‚ùå Credenciales incorrectas');
            }
        }

        function logout() {
            document.getElementById('app').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('username').value = 'admin';
            document.getElementById('password').value = '';
        }

        // INICIALIZAR
        function inicializarSistema() {
            actualizarDashboard();
            actualizarHistorial();
            actualizarSelectProductos();
            detectarConexion();
        }

        // PESTA√ëAS
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
            
            if (tab === 'egreso') actualizarSelectProductos();
        }

        // GUARDAR DATOS
        function guardarDatos() {
            localStorage.setItem('inventarioYegni', JSON.stringify(inventario));
            localStorage.setItem('historialYegni', JSON.stringify(historial));
        }

        // INGRESO
        function agregarIngreso() {
            const producto = document.getElementById('productoIngreso').value.trim();
            const categoria = document.getElementById('categoriaIngreso').value;
            const cantidad = parseInt(document.getElementById('cantidadIngreso').value);
            const precio = parseFloat(document.getElementById('precioIngreso').value);
            const responsable = document.getElementById('responsableIngreso').value.trim();
            const caracteristicas = document.getElementById('caracteristicasIngreso').value.trim();

            if (!producto || !categoria || !cantidad || !precio || !responsable) {
                alert('‚ùå Completa todos los campos obligatorios');
                return;
            }

            if (cantidad < 1 || precio < 0) {
                alert('‚ùå Cantidad > 0 y Precio v√°lido');
                return;
            }

            const fechaHora = new Date().toLocaleString('es-VE');
            const productoExistente = inventario.find(p => p.nombre.toLowerCase() === producto.toLowerCase());

            if (productoExistente) {
                productoExistente.stock += cantidad;
                productoExistente.ingresos += cantidad;
                productoExistente.ultimoPrecio = precio;
            } else {
                inventario.push({
                    nombre: producto,
                    categoria,
                    stock: cantidad,
                    precio,
                    ingresos: cantidad,
                    egresos: 0,
                    caracteristicas: caracteristicas || '',
                    ultimoPrecio: precio
                });
            }

            // Agregar al historial
            historial.unshift({
                fecha: fechaHora,
                tipo: 'INGRESO',
                producto,
                categoria,
                cantidad,
                precio: precio * cantidad,
                responsable
            });

            guardarDatos();
            actualizarTodo();
            limpiarFormularioIngreso();
            alert('‚úÖ Ingreso registrado correctamente');
        }

        // EGRESO
        function registrarEgreso() {
            const nombre = document.getElementById('productoEgreso').value;
            const cantidad = parseInt(document.getElementById('cantidadEgreso').value);
            const responsable = document.getElementById('responsableEgreso').value.trim();

            if (!nombre || !cantidad || !responsable) {
                alert('‚ùå Completa todos los campos');
                return;
            }

            const producto = inventario.find(p => p.nombre === nombre);
            if (!producto) return alert('‚ùå Producto no encontrado');

            if (producto.stock < cantidad) {
                alert(`‚ùå Stock insuficiente. Disponible: ${producto.stock}`);
                return;
            }

            const precioTotal = (producto.ultimoPrecio || producto.precio) * cantidad;
            const fechaHora = new Date().toLocaleString('es-VE');

            producto.stock -= cantidad;
            producto.egresos += cantidad;

            historial.unshift({
                fecha: fechaHora,
                tipo: 'EGRESO',
                producto: nombre,
                categoria: producto.categoria,
                cantidad,
                precio: precioTotal,
                responsable
            });

            guardarDatos();
            actualizarTodo();
            limpiarFormularioEgreso();
            alert('‚úÖ Egreso registrado correctamente');
        }

        // ACTUALIZACIONES
        function actualizarTodo() {
            actualizarDashboard();
            actualizarHistorial();
            actualizarSelectProductos();
        }

        function actualizarDashboard() {
            const totalP = inventario.length;
            const totalS = inventario.reduce((sum, p) => sum + p.stock, 0);
            const lowS = inventario.filter(p => p.stock > 0 && p.stock < 10).length;
            const hoy = new Date().toDateString();
            const hoyM = historial.filter(m => new Date(m.fecha).toDateString() === hoy).length;

            document.getElementById('totalProducts').textContent = totalP;
            document.getElementById('totalStock').textContent = totalS.toLocaleString();
            document.getElementById('lowStock').textContent = lowS;
            document.getElementById('todayMoves').textContent = hoyM;

            const tbody = document.getElementById('inventoryBody');
            tbody.innerHTML = inventario.map(p => {
                const esBajo = p.stock > 0 && p.stock < 10;
                return `
                    <tr ${esBajo ? 'class="low-stock"' : ''}>
                        <td><strong>${p.nombre}</strong></td>
                        <td>${p.categoria}</td>
                        <td style="font-weight: 700; font-size: 1.2rem; color: ${p.stock === 0 ? 'var(--danger)' : 'var(--primary)'}">${p.stock}</td>
                        <td>$${p.ultimoPrecio?.toFixed(2) || p.precio?.toFixed(2) || '0.00'}</td>
                        <td>${p.ingresos || 0}</td>
                        <td>${p.egresos || 0}</td>
                        <td>${p.caracteristicas || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function actualizarSelectProductos() {
            const select = document.getElementById('productoEgreso');
            select.innerHTML = '<option value="">Selecciona un producto...</option>';
            inventario.forEach(p => {
                const option = new Option(`${p.nombre} (${p.stock} un)`, p.nombre);
                select.appendChild(option);
            });
        }

        function cargarDatosProducto() {
            const nombre = document.getElementById('productoEgreso').value;
            const producto = inventario.find(p => p.nombre === nombre);
            
            if (producto) {
                document.getElementById('categoriaEgreso').value = producto.categoria;
                document.getElementById('stockActual').value = producto.stock;
                document.getElementById('precioEgreso').value = (producto.ultimoPrecio || producto.precio || 0) * 1;
                document.getElementById('cantidadEgreso').max = producto.stock;
            }
        }

        function actualizarHistorial() {
            const tbody = document.getElementById('historialBody');
            tbody.innerHTML = historial.slice(0, 100).map(m => {
                const color = m.tipo === 'INGRESO' ? 'var(--accent)' : 'var(--danger)';
                return `
                    <tr>
                        <td>${m.fecha}</td>
                        <td style="color: ${color}; font-weight: 700;">${m.tipo}</td>
                        <td>${m.producto}</td>
                        <td>${m.categoria}</td>
                        <td style="font-weight: 700;">${m.cantidad}</td>
                        <td>$${m.precio.toFixed(2)}</td>
                        <td>${m.responsable}</td>
                    </tr>
                `;
            }).join('');
        }

        // FILTROS
        function filterProducts() {
            const filtro = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('#inventoryBody tr').forEach(row => {
                const nombre = row.cells[0].textContent.toLowerCase();
                row.style.display = nombre.includes(filtro) ? '' : 'none';
            });
        }

        function filtrarHoy() {
            const hoy = new Date().toDateString();
            document.querySelectorAll('#historialBody tr').forEach((row, i) => {
                const fecha = new Date(historial[i]?.fecha).toDateString();
                row.style.display = fecha === hoy ? '' : 'none';
            });
        }

        // EXPORTAR
        function exportarExcel() {
            let csv = 'Fecha,Tipo,Producto,Categor√≠a,Cantidad,Precio,Responsable\n';
            historial.slice(0, 1000).forEach(m => {
                csv += `"${m.fecha}","${m.tipo}","${m.producto}","${m.categoria}",${m.cantidad},${m.precio},"${m.responsable}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Inventario_YegniMaik_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // MODAL BORRAR
        function mostrarBorrarHistorial() {
            document.getElementById('modalBorrar').style.display = 'block';
        }

        function cerrarModal() {
            document.getElementById('modalBorrar').style.display = 'none';
        }

        function confirmarBorrarHistorial() {
            if (confirm('¬øBORRAR TODO el historial?')) {
                historial = [];
                guardarDatos();
                actualizarHistorial();
                cerrarModal();
                alert('‚úÖ Historial eliminado');
            }
        }

        // CONEXI√ìN
        function detectarConexion() {
            window.addEventListener('online', () => actualizarStatus(true));
            window.addEventListener('offline', () => actualizarStatus(false));
        }

        function actualizarStatus(online) {
            onlineStatus = online;
            const status = document.getElementById('status');
            if (online) {
                status.textContent = 'üü¢ Sistema Activo';
                status.className = 'status online';
            } else {
                status.textContent = 'üî¥ Sin Conexi√≥n';
                status.className = 'status offline';
            }
        }

        function sincronizarManual() {
            guardarDatos();
            actualizarTodo();
            alert('‚úÖ Datos sincronizados');
        }

        // LIMPIAR FORMULARIOS
        function limpiarFormularioIngreso() {
            document.getElementById('productoIngreso').value = '';
            document.getElementById('categoriaIngreso').value = '';
            document.getElementById('cantidadIngreso').value = '';
            document.getElementById('precioIngreso').value = '';
            document.getElementById('responsableIngreso').value = '';
            document.getElementById('caracteristicasIngreso').value = '';
        }

        function limpiarFormularioEgreso() {
            document.getElementById('cantidadEgreso').value = '';
            document.getElementById('responsableEgreso').value = '';
            document.getElementById('precioEgreso').value = '';
        }

        // EVENTOS TECLADO
        document.addEventListener('keypress', e => {
            if (e.key === 'Enter' && document.getElementById('loginScreen').style.display !== 'none') {
                login();
            }
        });

        // CIERRE MODAL
        window.onclick = e => {
            if (e.target.id === 'modalBorrar') cerrarModal();
        };
    </script>
</body>
</html>
